# Лабораторная работа "Изучение PAM"
PAM (Pluggable Authentication Modules) - система подгружаемых модулей аутентификации
## Расположение файлов:
- Конфигурационные файлы: `/etc/pam.conf`, `/etc/pam.d/`.
- Расположение модулей: `/lib64/security/`.
## Управляющие группы:
- `auth` - подтверждение личности пользователя. Обычно это имя пользователя и пароль, но возможны и другие варианты: смарт-карта, биометрические методы (отпечатки пальцев или сканирование сетчатки глаза).
- `account` - действия, определяющие, можно ли пользователю зайти в систему. Например ограничение входа пользователя в систему в зависимости от времени суток.
- `session` - действия по выделению ресурсов, которые могут потребоваться пользователю во время сессии, например, монтирование домашнего каталога пользователя, установка лимитов на использование ресурсов системы, вывод ежедневного сообщения и т. д.
- `password` - действия по обновлению "секрета" пользователя (обычно пароля).

## Управляющие флаги:
- `requisite` - если модуль завершается с ошибкой, PAM немедленно возвращает приложению ошибку, другие модули стека не вызываются.
- `required` - если модуль завершается с ошибкой, PAM возвращает ошибку приложению, но продолжает вызывать остальные модули стека.
- `sufficient` - если модуль завершается успешно, PAM возвращает приложению результат «выполнен», и остальные модули стека не вызываются. (Предполагается, что никакой модуль с required выше в стеке не отказал.)
- `optional` - результат работы модуля (выполнен/ошибка) игнорируется. Обычно это означает, что модуль вызывается для выполнения некой операции, не имеющей отношения к принятию решения «пропустить/отказать» для всего стека.
- `include` - включает все строки данного типа из конфигурационного файла, переданного в качестве аргумента.
- `substack` - включает все строки данного типа из конфигурационного файла, переданного в качестве аргумента.


## PAM
1. Определите, использует ли данная программа систему PAM, или нет. Например:

```sh
 $ ldd /bin/login | grep pam
 	libpam.so.0 => /lib64/libpam.so.0 (0x00007fe3a8428000)
 	libpam_misc.so.0 => /lib64/libpam_misc.so.0 (0x00007fe3a8223000)
```
2. Изучите содержимое каталогов, в которых хранятся библиотеки и модули:

```sh
 $ ls -l /lib64/libpam*
 $ ls -l /lib64/security/
```

## Разрешите всем пользователям переключаться в root без ввода пароля с помощью команды su:

1. Включите в начало файла `/etc/pam.d/su` (в стеке auth) строку:
```sh
 auth sufficient pam_permit.so
```

2. Зайдите в систему как обычный пользователь и проверьте, что можете переключиться в режим root с помощью su без ввода пароля, например, выполните команду:
```sh
 $ su -c "hostname mephi"
```
3. Верните систему в исходное состояние.

## Запретите всем пользователям использовать команду su
1. Оставьте в файле `/etc/pam.d/su` только одну строку, относящуюся к стеку auth:
```sh
 auth requisite pam_deny.so
```
2. Зайдите в систему как обычный пользователь и убедитесь, что переключения в режим root не происходит.

Верните систему в исходное состояние.

## Разрешите выполнять команду su только пользователям из группы wheel

1. Модуль `pam_wheel.so` разрешает доступ только тем пользователям, которые входят в группу wheel. Отредактируйте файл /etc/pam.d/su так, чтобы стек auth выглядел следующим образом:

```sh
 auth sufficient pam_rootok.so
 auth required pam_wheel.so use_uid
 auth substack system-auth
 auth include postlogin
```

- `auth sufficient pam_rootok.so`: Этот модуль pam_rootok.so позволяет выполнение команды su без запроса пароля, если пользователь уже является суперпользователем (root). sufficient указывает, что если этот модуль завершает свое выполнение успешно, дальнейшая проверка завершается успешно и не выполняются остальные модули auth.
- `auth required pam_wheel.so use_uid`: Этот модуль pam_wheel.so требует, чтобы пользователь был членом группы wheel для доступа к команде su. use_uid указывает, что он будет использовать числовой идентификатор пользователя (UID) для проверки членства в группе, а не имя пользователя. Таким образом, только пользователи, входящие в группу wheel, смогут использовать su.
- `auth substack system-auth`: Эта строка подключает файл system-auth для выполнения дополнительных проверок аутентификации. Файл system-auth содержит стандартные настройки аутентификации, определенные для системы.
- `auth include postlogin`: Эта строка включает модуль postlogin, который выполняет дополнительные действия после завершения сеанса. Это может включать в себя такие действия, как вывод информации о последнем входе пользователя.


2. Добавте пользователя user1 в группу wheel.

3. Зайдите в систему как user1 и попробуйте использовать команду su. Будет запрошен пароль администратора, после чего должен открыться сеанс администратора.

4. Зайдите в систему под другим пользователем (не членом группы wheel) и попробуйте использовать команду su. Снова будет запрошен пароль администратора, но переключиться в сеанс root не удастся.

5. Измените управляющий флаг для модуля `pam_wheel` на `requisite`. Повторите эксперимент. Что изменилось и почему?

6. Верните систему в исходное состояние.

## Запретите вход в систему пользователю root через терминалы

1. Модуль `pam_securetty.so` запрещает вход в систему от имени root на терминалах, которых нет в списке `/etc/securetty`. Добавьте в файл `/etc/pam.d/login` на вершину стека auth следующую строку:
```sh
 auth required pam_securetty.so
```

2. Очистите список, предварительно создав резервную копию файла. Обратите внимание, что пустой файл `/etc/securetty` запрещает вход root на все терминалы, а отсутствие этого файла - разрешает.

3. Попытайтесь зайти в систему через терминал под именем root, введя правильный пароль.

4. Убедитесь, что можно зайти в систему под обычным пользователем.

## Качество пароля

1. Модуль `pam_pwquality.so` проверяет качество пароля. Прочтите справку:
```sh
 $ man pam_pwquality
```

2. Добавьте в файл `/etc/security/pwquality.conf` следующую строку:
```sh
 minlen = 12
```

3. Добавьте в файл `/etc/pam.d/system-auth` следующую строку:
```sh
 password requisite pam_pwquality.so try_first_pass local_users_only retry=5 authtok_type=MEPhI
```

6. Попытайтесь изменить свой пароль, выбирая его длину меньше 11. Сколько попыток даётся пользователю?

7. Верните систему в исходное состояние.


## Ограничение на вход в систему

1. Модуль `pam_limits.so` проверяет различные лимиты. Прочтите справку:
```sh
 $ man pam_limits
```
2. Добавьте в файл `/etc/security/limits.conf` следующую строку:
```sh
 user1 hard maxlogins 2
```
3. Попытайтесь зайти в систему через терминалы больше двух раз. Сколько раз удалось зайти?


## Разработка программы, использующей PAM

